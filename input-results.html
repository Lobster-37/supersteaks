<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Match Results - SuperSteaks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-functions-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC7eQhMsCeQYcQrQq_BR1Wy7cCE4JltD5s",
            authDomain: "supersteaks-240f7.firebaseapp.com",
            projectId: "supersteaks-240f7",
            storageBucket: "supersteaks-240f7.appspot.com",
            messagingSenderId: "325643072121",
            appId: "1:325643072121:web:9c3c7d3c64c431bc77daa8"
        };
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.error('Firebase initialization failed:', error);
        }
    </script>
    <link rel="stylesheet" href="css/supersteaks-global.js">
</head>
<body class="bg-gray-50">
    <header class="bg-indigo-800 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <h1 class="text-3xl font-bold text-yellow-400">SUPERSTEAKS</h1>
                    <span class="text-sm text-gray-300">Match Results Input</span>
                </div>
                <button onclick="logout()" id="logoutBtn" class="hidden bg-red-600 hover:bg-red-700 px-4 py-2 rounded font-semibold transition">
                    Sign Out
                </button>
            </div>
        </div>
    </header>

    <div class="max-w-4xl mx-auto p-6">
        <!-- Login Section -->
        <div id="loginSection" class="bg-white rounded-lg shadow p-8 mb-6">
            <h2 class="text-2xl font-bold mb-6 text-indigo-800">Admin Login</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">Email</label>
                    <input type="email" id="email" placeholder="admin@example.com" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Password</label>
                    <input type="password" id="password" placeholder="Password" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <button onclick="handleLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded font-bold transition">
                    Sign In
                </button>
                <div id="loginError" class="hidden bg-red-50 border border-red-300 text-red-800 p-3 rounded text-sm"></div>
            </div>
        </div>

        <!-- Input Form Section -->
        <div id="formSection" class="hidden">
            <!-- League Selector -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Select League</h2>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="selectLeague('premier-league')" class="league-btn p-3 rounded font-semibold bg-gray-100 hover:bg-indigo-100 transition" data-league="premier-league">
                        Premier League
                    </button>
                    <button onclick="selectLeague('championship')" class="league-btn p-3 rounded font-semibold bg-gray-100 hover:bg-indigo-100 transition" data-league="championship">
                        Championship
                    </button>
                    <button onclick="selectLeague('league-one')" class="league-btn p-3 rounded font-semibold bg-gray-100 hover:bg-indigo-100 transition" data-league="league-one">
                        League One
                    </button>
                    <button onclick="selectLeague('league-two')" class="league-btn p-3 rounded font-semibold bg-gray-100 hover:bg-indigo-100 transition" data-league="league-two">
                        League Two
                    </button>
                    <button onclick="selectLeague('champions-league')" class="league-btn p-3 rounded font-semibold bg-gray-100 hover:bg-indigo-100 transition col-span-2" data-league="champions-league">
                        Champions League
                    </button>
                </div>
            </div>

            <!-- Match Result Input -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-bold mb-6 text-gray-800">Input Match Result</h2>
                
                <div id="matchForm" class="space-y-6">
                    <!-- Home Team -->
                    <div>
                        <label class="block text-sm font-semibold mb-2">Home Team</label>
                        <select id="homeTeam" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">-- Select Home Team --</option>
                        </select>
                    </div>

                    <!-- Away Team -->
                    <div>
                        <label class="block text-sm font-semibold mb-2">Away Team</label>
                        <select id="awayTeam" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">-- Select Away Team --</option>
                        </select>
                    </div>

                    <!-- Scores -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Home Score</label>
                            <input type="number" id="homeScore" min="0" max="10" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Away Score</label>
                            <input type="number" id="awayScore" min="0" max="10" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0">
                        </div>
                    </div>

                    <!-- Match Date -->
                    <div>
                        <label class="block text-sm font-semibold mb-2">Match Date</label>
                        <input type="date" id="matchDate" class="w-full border border-gray-300 p-3 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>

                    <!-- Submit Button -->
                    <button onclick="submitResult()" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded font-bold transition">
                        Submit Result
                    </button>

                    <!-- Status Messages -->
                    <div id="resultStatus" class="hidden p-4 rounded text-sm"></div>
                </div>
            </div>

            <!-- Recent Results -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Recent Results</h2>
                <div id="recentResults" class="space-y-2 max-h-64 overflow-y-auto">
                    <p class="text-gray-500 text-sm">No results entered yet</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/supersteaks-global.js"></script>
    <script>
        let currentLeague = null;
        let leaguesData = {
            'premier-league': { name: 'Premier League', teams: ['Liverpool', 'Arsenal', 'Manchester City', 'Chelsea', 'Manchester United', 'Tottenham', 'Brighton', 'Newcastle', 'Fulham', 'Aston Villa', 'West Ham', 'Crystal Palace', 'Brentford', 'Bournemouth', 'Everton', 'Wolverhampton', 'Nottingham Forest', 'Leicester', 'Ipswich', 'Southampton'] },
            'championship': { name: 'Championship', teams: ['Leeds United', 'West Bromwich Albion', 'Cardiff City', 'Bristol City', 'Coventry City', 'Derby County', 'Preston North End', 'Middlesbrough', 'Plymouth Argyle', 'Stoke City', 'Hull City', 'Portsmouth', 'Norwich City', 'Watford', 'Luton Town', 'Millwall', 'Reading', 'Sunderland', 'Swansea City', 'Blackburn Rovers'] },
            'league-one': { name: 'League One', teams: ['Wrexham', 'Wycombe Wanderers', 'Stockport County', 'Birmingham City', 'Rotherham United', 'Leyton Orient', 'Lincoln City', 'Bolton Wanderers', 'Port Vale', 'Mansfield Town', 'Peterborough United', 'Ipswich Town', 'Cheltenham Town', 'Northampton Town', 'Shrewsbury Town', 'Crawley Town', 'Burton Albion', 'Salford City', 'MK Dons', 'Charlton Athletic'] },
            'league-two': { name: 'League Two', teams: ['Doncaster Rovers', 'Forest Green Rovers', 'Salford City Reserve', 'Swindon Town', 'Grimsby Town', 'Bradford City', 'Harrogate Town', 'Barrow', 'Stevenage', 'Tranmere Rovers', 'Newport County', 'Colchester United', 'Southend United', 'Leyton Orient Reserve', 'Cambridge United', 'Accrington Stanley', 'Hartlepool United', 'Scunthorpe United', 'Crewe Alexandra', 'Exeter City'] },
            'champions-league': { name: 'Champions League', teams: ['Manchester City', 'Real Madrid', 'Bayern Munich', 'PSG', 'Liverpool', 'Barcelona', 'Arsenal', 'AC Milan', 'Inter Milan', 'Juventus', 'Dortmund', 'Atletico Madrid', 'Chelsea', 'Benfica', 'Napoli', 'RB Leipzig', 'Porto', 'Ajax'] }
        };

        document.addEventListener('DOMContentLoaded', () => {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    document.getElementById('loginSection').classList.add('hidden');
                    document.getElementById('formSection').classList.remove('hidden');
                    document.getElementById('logoutBtn').classList.remove('hidden');
                } else {
                    document.getElementById('loginSection').classList.remove('hidden');
                    document.getElementById('formSection').classList.add('hidden');
                    document.getElementById('logoutBtn').classList.add('hidden');
                }
            });

            // Set today's date as default
            document.getElementById('matchDate').valueAsDate = new Date();
        });

        async function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');

            try {
                await firebase.auth().signInWithEmailAndPassword(email, password);
                errorDiv.classList.add('hidden');
            } catch (error) {
                errorDiv.textContent = 'Login failed: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        }

        async function logout() {
            await firebase.auth().signOut();
        }

        function selectLeague(leagueKey) {
            currentLeague = leagueKey;
            
            // Update button styles
            document.querySelectorAll('.league-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('bg-gray-100');
            });
            event.target.classList.remove('bg-gray-100');
            event.target.classList.add('bg-indigo-600', 'text-white');

            // Load teams
            const teams = leaguesData[leagueKey].teams;
            const homeSelect = document.getElementById('homeTeam');
            const awaySelect = document.getElementById('awayTeam');
            
            homeSelect.innerHTML = '<option value="">-- Select Home Team --</option>';
            awaySelect.innerHTML = '<option value="">-- Select Away Team --</option>';
            
            teams.forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team;
                option1.textContent = team;
                homeSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = team;
                option2.textContent = team;
                awaySelect.appendChild(option2);
            });
        }

        async function submitResult() {
            if (!currentLeague) {
                alert('Please select a league');
                return;
            }

            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const homeScore = parseInt(document.getElementById('homeScore').value);
            const awayScore = parseInt(document.getElementById('awayScore').value);
            const matchDate = document.getElementById('matchDate').value;

            if (!homeTeam || !awayTeam) {
                alert('Please select both teams');
                return;
            }

            if (isNaN(homeScore) || isNaN(awayScore)) {
                alert('Please enter valid scores');
                return;
            }

            if (homeTeam === awayTeam) {
                alert('Home and away teams must be different');
                return;
            }

            const statusDiv = document.getElementById('resultStatus');
            statusDiv.className = 'p-4 rounded text-sm bg-blue-50 text-blue-800';
            statusDiv.textContent = '⏳ Submitting result...';
            statusDiv.classList.remove('hidden');

            try {
                const submitResult = firebase.functions().httpsCallable('submitMatchResult');
                const result = await submitResult({
                    league: currentLeague,
                    homeTeam,
                    awayTeam,
                    homeScore,
                    awayScore,
                    matchDate
                });

                statusDiv.className = 'p-4 rounded text-sm bg-green-50 text-green-800';
                statusDiv.textContent = '✅ Result submitted! Standings have been updated.';
                
                // Reset form
                document.getElementById('homeTeam').value = '';
                document.getElementById('awayTeam').value = '';
                document.getElementById('homeScore').value = '';
                document.getElementById('awayScore').value = '';
                document.getElementById('matchDate').valueAsDate = new Date();

                // Reload recent results
                loadRecentResults();

            } catch (error) {
                statusDiv.className = 'p-4 rounded text-sm bg-red-50 text-red-800';
                statusDiv.textContent = '❌ Error: ' + (error.details?.message || error.message);
            }
        }

        async function loadRecentResults() {
            if (!currentLeague) return;

            try {
                const db = firebase.firestore();
                const resultsRef = db.collection('leagues').doc(currentLeague).collection('results');
                const snapshot = await resultsRef.orderBy('timestamp', 'desc').limit(10).get();

                const container = document.getElementById('recentResults');
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">No results yet</p>';
                    return;
                }

                let html = '';
                snapshot.forEach(doc => {
                    const result = doc.data();
                    html += `
                        <div class="border-l-4 border-indigo-500 bg-gray-50 p-3 rounded">
                            <div class="font-semibold">${result.homeTeam} <span class="text-lg text-indigo-600">${result.homeScore}</span> - <span class="text-lg text-indigo-600">${result.awayScore}</span> ${result.awayTeam}</div>
                            <div class="text-xs text-gray-500 mt-1">${result.date || 'N/A'}</div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading results:', error);
            }
        }

        // Watch league changes
        const observer = new MutationObserver(() => {
            loadRecentResults();
        });
    </script>
</body>
</html>
